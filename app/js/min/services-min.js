!function(){"use strict";function e(e){var o=Array.prototype.slice.call(arguments,1);return o.forEach(function(o){if(o&&"object"==typeof o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])}),e}angular.module("myApp.services",["firebase","ngRoute"]).service("FsGet",["fsConfig","$http","$firebase","$firebaseObject",function(e,o,t,n){var a=new Firebase(e.FIREBASE_URL);return{getBook:function(e){var o=a.child("Books").child(e);return o},getUser:function(e){var o=a.child("users").child(e);return o},getSuggested:function(e){var o=a.child("nominated/Books").child(e);return o},getMessage:function(e){var o=a.child("system/usermessages").child(e);return o},getBook1:function(e){var o=n(a.child("Books").child(e));return o},getUser1:function(e){var o=n(a.child("users").child(e));return console.log("getUser1 was triggered with the id of"+e),o},getRole:function(e){var o=n(a.child("users").child(e).child("role"));return console.log("getRole was triggered with the id of"+e),o}}}]).service("FsStats",["fsConfig","$firebaseObject",function(e,o){var t=new Firebase(e.FIREBASE_URL);return{addBookView:function(e){console.log("addBookView was called"),console.log(e);var n=o(t.child("Books").child(e));n.$loaded().then(function(){var e=n.viewCount;return e||(e=0),n.viewCount=e+1,n.$save(),n})}}}]).service("FsNotifyWithId",["fsConfig","$http","$firebase","FsNotify","FsGet",function(e,o,t,n,a){return{bookAdded:function(e,o){var t,s;a.getBook(o).on("value",function(r){s=r.val(),a.getUser(e).on("value",function(a){t=a.val(),t.$id=e,s.$id=o,n.bookAdded(t,s)})})},bookSuggested:function(e,o){var t,s;a.getSuggested(o).on("value",function(r){s=r.val(),console.log(r.val()),a.getUser(e).on("value",function(a){console.log(a.val()),t=a.val(),t.$id=e,s.$id=o,n.bookSuggested(t,s)})})},systemMessage:function(e,o){var t,s;a.getUser(e).on("value",function(r){t=r.val(),console.log(t),a.getMessage(o).on("value",function(a){s=a.val(),console.log(s),console.log(t),t.$id=e,s.$id=o,n.systemMessage(t,s)})})}}}]).service("FsNotify",["fsConfig","$http","$firebase","$firebaseArray","$firebaseObject","filterFilter",function(e,o,t,n,a,s){var r=new Firebase(e.FIREBASE_URL),i=n(r.child("places")),l=n(r.child("users")),c=n(r.child("Books")),d=n(r.child("collections")),u=r.child("messages"),g=r.child("/system/adminmessages");return{bookAdded:function(e,o,t){var n=!1;t="undefined"!=typeof t?t:!1;var a=(new Date).valueOf(),r="bookAdded",i="New Book Added",c=o.title+" was added.",d=e.$id;return g.push({messageType:r,title:"A Book was added",messageContent:"'"+o.title+"' was added by "+e.displayName,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,timestamp:a}),l.$loaded().then(function(){var t="";angular.forEach(o.places,function(n){var i=!1,c=!1;console.log("thePlace is:"+n.name);var d=n.geonameId,g=parseFloat(n.countryId);if(console.log(parseFloat(n.geonameId)),console.log(parseFloat(n.countryId)),d==g&&(i=!0,console.log("IT IS A COUNTRY")),console.log("sentcountryid:"+t),console.log("placecountry id:"+parseFloat(n.countryId)),t!=parseFloat(n.countryId)){var f=s(l,{following:g});console.log(f),f.length||console.log("NO ONE IS FOLLOWING "+n.name),angular.forEach(f,function(t){if(t.following[parseFloat(n.countryId)])var s=t.following[parseFloat(n.countryId)].countryId;if(console.log(s),s==parseFloat(n.countryId)){console.log("yep, ets do this"),console.log("notifying a country");var i=t.$id;u.child(i).push({userId:i,messageType:r,title:"New Book Added",messageContent:o.title+" was added, set in "+n.name,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.countryId),followsName:n.countryName,timestamp:a},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})}}),t=parseFloat(n.countryId),c=!0}if(!i){var m=s(l,{following:d});console.log(m),m.length||console.log("NO ONE IS FOLLOWING "+n.name),angular.forEach(m,function(t){console.log(t);var s=t.$id;u.child(s).push({userId:s,messageType:r,title:"New Book Added",messageContent:o.title+" was added, set in "+n.name,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.geonameId),followsName:n.name,timestamp:a},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}})}),"Book added: Admin and users notified"},bookSuggested:function(e,o){var t=(new Date).valueOf(),n="bookSuggested",a="New Book Suggested",r=o.title+" was suggested.";return g.push({messageType:n,title:"A Book was suggested",messageContent:"'"+o.title+"' was suggested by "+e.displayName,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,timestamp:t}),l.$loaded().then(function(){var a="";angular.forEach(o.places,function(r){var i=!1,c=!1;console.log("thePlace is:"+r.name);var d=r.geonameId,g=parseFloat(r.countryId);if(console.log(parseFloat(r.geonameId)),console.log(parseFloat(r.countryId)),d==g&&(i=!0,console.log("IT IS A COUNTRY")),console.log("sentcountryid:"+a),console.log("placecountry id:"+parseFloat(r.countryId)),a!=parseFloat(r.countryId)){var f=s(l,{following:g});console.log(f),f.length||console.log("NO ONE IS FOLLOWING "+r.name),angular.forEach(f,function(a){if(a.following[parseFloat(r.countryId)])var s=a.following[parseFloat(r.countryId)].countryId;if(console.log(s),s==parseFloat(r.countryId)){console.log("yep, ets do this"),console.log("notifying a country");var i=a.$id;u.child(i).push({userId:i,messageType:n,title:"New Book Suggested",messageContent:o.title+" was suggested, set in "+r.name,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:r.geonameId,locationName:r.name,countryId:parseFloat(r.countryId),countryName:r.countryName,followsId:parseFloat(r.countryId),followsName:r.countryName,timestamp:t},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})}}),a=parseFloat(r.countryId),c=!0}if(!i){var m=s(l,{following:d});console.log(m),m.length||console.log("NO ONE IS FOLLOWING "+r.name),angular.forEach(m,function(a){console.log(a);var s=a.$id;u.child(s).push({userId:s,messageType:n,title:"New Book Suggested",messageContent:o.title+" was suggested, set in "+r.name,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:r.geonameId,locationName:r.name,countryId:parseFloat(r.countryId),countryName:r.countryName,followsId:parseFloat(r.geonameId),followsName:r.name,timestamp:t},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}})}),"Book added: Admin and users notified"},systemMessage:function(e,o){var t=(new Date).valueOf(),n="system";return l.$loaded().then(function(){angular.forEach(l,function(e){var a=e.$id;u.child(a).push({userId:a,messageType:n,title:o.title,messageContent:o.messageContent,messageLink:o.messageLink,activatorName:o.authorName,activatorId:o.authorId,timestamp:t},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}),"System Message Added"}}}]).factory("Flickr",["$resource","$q",function(e,o){var t=e("http://api.flickr.com/services/feeds/photos_public.gne",{format:"json",jsoncallback:"JSON_CALLBACK"},{load:{method:"JSONP"}});return{search:function(e){var n=o.defer();return t.load({tags:e},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}]).factory("FlickrPlace",["$http","$q",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.places.find&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&query=";return{getPlace:function(n){return e.get(t+n).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}]).factory("FlickrPlacePics",["$http","$q",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&per_page=20&min_taken_date=1262304000&extras=url_m,url_s&sort=interestingness-desc&place_id=",n="&bbox="+n,a="&tags=crete",s="&is_getty=true";return{getPics:function(n,a){return e.get(t+n).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}]).factory("DataSource",["$http",function(e){return{get:function(o,t,n){e.get(o).success(function(e,o){console.log("Request succeeded"),t(e)}).error(function(e,o){console.log("Request failed "+o)})}}}])}();
//# sourceMappingURL=./services-min.js.map