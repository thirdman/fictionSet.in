!function(){"use strict";function e(e){var o=Array.prototype.slice.call(arguments,1);return o.forEach(function(o){if(o&&"object"==typeof o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])}),e}angular.module("myApp.services",["firebase","ngRoute"]).service("FsGet",["fsConfig","$http","$firebaseObject",function(e,o,t){var n=new Firebase(e.FIREBASE_URL);return{getBook:function(e){var o=n.child("Books").child(e);return o},getUser:function(e){var o=n.child("users").child(e);return o},getSuggested:function(e){var o=n.child("nominated/Books").child(e);return o},getMessage:function(e){var o=n.child("system/usermessages").child(e);return o},getBook1:function(e){var o=t(n.child("Books").child(e));return o},getUser1:function(e){var o=t(n.child("users").child(e));return console.log("getUser1 was triggered with the id of "+e),o},getRole:function(e){var o=t(n.child("users").child(e).child("role"));return console.log("getRole was triggered with the id of "+e),o}}}]).service("FsStats",["fsConfig","$firebaseObject",function(e,o){var t=new Firebase(e.FIREBASE_URL);return{addBookView:function(e){console.log("addBookView was called"),console.log(e);var n=o(t.child("Books").child(e));n.$loaded().then(function(){var e=n.viewCount;return e||(e=0),n.viewCount=e+1,n.$save(),n})}}}]).service("FsNotifyWithId",["fsConfig","$http","$firebase","FsNotify","FsGet",function(e,o,t,n,a){return{bookAdded:function(e,o){var t,s;a.getBook(o).on("value",function(r){s=r.val(),a.getUser(e).on("value",function(a){t=a.val(),t.$id=e,s.$id=o,n.bookAdded(t,s)})})},bookSuggested:function(e,o){var t,s;a.getSuggested(o).on("value",function(r){s=r.val(),console.log(r.val()),a.getUser(e).on("value",function(a){console.log(a.val()),t=a.val(),t.$id=e,s.$id=o,n.bookSuggested(t,s)})})},systemMessage:function(e,o){var t,s;a.getUser(e).on("value",function(r){t=r.val(),console.log(t),a.getMessage(o).on("value",function(a){s=a.val(),console.log(s),console.log(t),t.$id=e,s.$id=o,n.systemMessage(t,s)})})}}}]).service("FsNotify",["fsConfig","$http","$firebase","$firebaseArray","$firebaseObject","filterFilter",function(e,o,t,n,a,s){var r,l,i,c=new Firebase(e.FIREBASE_URL);r=n(c.child("places"));var d=n(c.child("users"));i=n(c.child("Books")),l=n(c.child("collections"));var u=c.child("messages"),g=c.child("/system/adminmessages");return{bookAdded:function(e,o,t){t="undefined"!=typeof t?t:!1;var n,a,r,l=(new Date).valueOf(),i="bookAdded";return r="New Book Added",a=o.title+" was added.",n=e.$id,g.push({messageType:i,title:"A Book was added",messageContent:"'"+o.title+"' was added by "+e.displayName,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,timestamp:l}),d.$loaded().then(function(){var t="";angular.forEach(o.places,function(n){var a=!1,r=!1;console.log("thePlace is:"+n.name);var c=n.geonameId,g=parseFloat(n.countryId);if(console.log(parseFloat(n.geonameId)),console.log(parseFloat(n.countryId)),c===g&&(a=!0,console.log("IT IS A COUNTRY")),console.log("sentcountryid:"+t),console.log("placecountry id:"+parseFloat(n.countryId)),t!==parseFloat(n.countryId)){var f=s(d,{following:g});console.log(f),f.length||console.log("NO ONE IS FOLLOWING "+n.name);var m;angular.forEach(f,function(t){if(t.following[parseFloat(n.countryId)]&&(m=t.following[parseFloat(n.countryId)].countryId),console.log(m),m===parseFloat(n.countryId)){console.log("yep, ets do this"),console.log("notifying a country");var a=t.$id;u.child(a).push({userId:a,messageType:i,title:"New Book Added",messageContent:o.title+" was added, set in "+n.name,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.countryId),followsName:n.countryName,timestamp:l},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})}}),t=parseFloat(n.countryId),r=!0}if(!a){var p=s(d,{following:c});console.log(p),p.length||console.log("NO ONE IS FOLLOWING "+n.name),angular.forEach(p,function(t){console.log(t);var a=t.$id;u.child(a).push({userId:a,messageType:i,title:"New Book Added",messageContent:o.title+" was added, set in "+n.name,messageLink:"http://fictionset.in/#/book/"+o.$id,activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.geonameId),followsName:n.name,timestamp:l},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}})}),"Book added: Admin and users notified"},bookSuggested:function(e,o){var t,n,a=(new Date).valueOf(),r="bookSuggested";return t="New Book Suggested",n=o.title+" was suggested.",g.push({messageType:r,title:"A Book was suggested",messageContent:"'"+o.title+"' was suggested by "+e.displayName,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,timestamp:a}),d.$loaded().then(function(){var t="";angular.forEach(o.places,function(n){var l=!1,i=!1;console.log("thePlace is:"+n.name);var c=n.geonameId,g=parseFloat(n.countryId);if(console.log(parseFloat(n.geonameId)),console.log(parseFloat(n.countryId)),c===g&&(l=!0,console.log("IT IS A COUNTRY")),console.log("sentcountryid:"+t),console.log("placecountry id:"+parseFloat(n.countryId)),t!==parseFloat(n.countryId)){var f=s(d,{following:g});console.log(f),f.length||console.log("NO ONE IS FOLLOWING "+n.name);var m;angular.forEach(f,function(t){if(t.following[parseFloat(n.countryId)]&&(m=t.following[parseFloat(n.countryId)].countryId),console.log(m),m===parseFloat(n.countryId)){console.log("yep, ets do this"),console.log("notifying a country");var s=t.$id;u.child(s).push({userId:s,messageType:r,title:"New Book Suggested",messageContent:o.title+" was suggested, set in "+n.name,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.countryId),followsName:n.countryName,timestamp:a},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})}}),t=parseFloat(n.countryId),i=!0}if(!l){var p=s(d,{following:c});console.log(p),p.length||console.log("NO ONE IS FOLLOWING "+n.name),angular.forEach(p,function(t){console.log(t);var s=t.$id;u.child(s).push({userId:s,messageType:r,title:"New Book Suggested",messageContent:o.title+" was suggested, set in "+n.name,messageLink:"http://fictionset.in/#/requests/",activatorName:e.displayName,activatorId:e.$id,bookId:o.$id,bookTitle:o.title,coverurl:o.coverurl,locationId:n.geonameId,locationName:n.name,countryId:parseFloat(n.countryId),countryName:n.countryName,followsId:parseFloat(n.geonameId),followsName:n.name,timestamp:a},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}})}),"Book added: Admin and users notified"},systemMessage:function(e,o){var t=(new Date).valueOf(),n="system";return d.$loaded().then(function(){angular.forEach(d,function(e){var a=e.$id;u.child(a).push({userId:a,messageType:n,title:o.title,messageContent:o.messageContent,messageLink:o.messageLink,activatorName:o.authorName,activatorId:o.authorId,timestamp:t},function(e){e?(console.log("error: "),console.log(e)):console.log("notified.")})})}),"System Message Added"}}}]).factory("Flickr",["$resource","$q",function(e,o){var t=e("http://api.flickr.com/services/feeds/photos_public.gne",{format:"json",jsoncallback:"JSON_CALLBACK"},{load:{method:"JSONP"}});return{search:function(e){var n=o.defer();return t.load({tags:e},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}]).factory("FlickrPlace",["$http","$q",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.places.find&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&query=";return{getPlace:function(n){return e.get(t+n).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}]).factory("FlickrPlacePics",["$http","$q",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&per_page=20&min_taken_date=1262304000&extras=url_m,url_s&sort=interestingness-desc&place_id=";return{getPics:function(n,a){return e.get(t+n).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}]).factory("DataSource",["$http",function(e){return{get:function(o,t,n){e.get(o).success(function(e,o){console.log("Request succeeded"),t(e)}).error(function(e,o){console.log("Request failed "+o+" and data: "),console.log(e)})}}}])}();
//# sourceMappingURL=./services-min.js.map