app.controller("BookCtrl",["$scope","$rootScope","currentUser","$firebase","$routeParams","$location","$timeout","DataSource","iTunesData","Profile","filterFilter","ngDialog","$log",function(o,e,i,l,n,c,s,t,a,r,d,g,h,u){function p(e){var i="https://sweltering-fire-3219.firebaseio.com/users",l=new Firebase(i);console.log(l),l.child(e).once("value",function(e){var i=null!==e.val(),l=e.val(),n=l.role,c=l.role>50;o.userRole=n,o.userAaa=c})}o.isLoading=!0;var b=!1;o.isBookmarking=b,o.hasData=!1,o.isLoadingAmazon=!1,o.noAmazon=!0,o.hasAmazon=!1,o.amazonData="",o.userAaa=!1,o.userRole=0,o.relatedBooks="";var f="/",m="pk.eyJ1IjoidGhpcmRtYW4iLCJhIjoidjBOQ0lrYyJ9.8zzETVcyoBg2nlMquUR1TA",v="http://api.tiles.mapbox.com/v4/thirdman.j1o1gjim",k="",A;o.mapUrlString=k;var w=5,y,B,C="",P="",F="",T="",z=!1,I=[],D="",L=n.id,z;o.inCollection=z,o.bookid=L,o.testContent="ggg",o.collectionFollowing=!1,o.collectionAdded=!1,o.collectionProcessing=!1;var R=!1;o.collectionShowCreate=R;var U={};o.collectionsObj=U;var N=[];o.collectionsArray=N;var O=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+L),j=l(O);o.book=j.$asObject();var S=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+L)).$asObject(),E=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray();o.bookplaces={};var _=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"),M=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+L+"/tags/0")).$asArray();S.$loaded().then(function(){if(o.hasData=!0,o.isLoading=!1,e.pageTitle="Book: "+S.title,console.log("Book Obj is:"),console.log(S),S.amazon_id.length){var l="http://fictionset.in/admin/amazon/amazon_getBook.php?search="+S.amazon_id;V(l)}if(_.once("value",function(o){var e=o.val()}),S.places){var n=[];n=S.places,o.bookPlaces=n;var c=!0,s=0,t="",a=[];angular.forEach(n,function(e){""==P?(C=e.lat,P=e.lat):(e.lat>C&&(C=e.lat),e.lat<P&&(P=e.lat)),""==T?(F=e.lng,T=e.lng):(e.lat>F&&(F=e.lng),e.lat<T&&(T=e.lng));var i="pin-m-library+222("+e.lng+","+e.lat+")";"/"==f?f+=i:f=f+","+i,t!=e.countryId&&(console.log("Locations is not from the same country"),t=e.countryId,a.push(e)),c&&(y=e.lat,B=e.lng,o.bkLng=B,o.bkLat=y,1==s&&(c=!1)),s+=1}),C=parseFloat(C),P=parseFloat(P),F=parseFloat(F),T=parseFloat(T);var r=Math.abs(P-C),g=Math.abs(T-F),h=Math.abs(F-C)/2,u=Math.abs(T-P)/2;w=10>h?8:30>h?5:60>h?3:80>h?2:1,console.log(w),w=10>u?8:30>u?6:60>u?4:60>u?3:140>u?2:1,console.log("bkZoom:"+w),y=(C+P)/2,B=(F+T)/2;var p=v+f,b="/"+B+","+y+","+w+"/1200x300.png?access_token="+m,k=p+b;o.mapUrlString=k;var A=[];E.$loaded().then(function(){angular.forEach(a,function(e){X(e.countryId);var i=d(E,e.countryId);console.log(i),e.countryBooks=i,A.push(e),o.relatedBooks=A})})}else o.bkLng="100",o.bkLat="0";if(S.apple_id){console.log("Yo, apple id already here");var z=S.apple_id;Z(z)}else if(S.isbn13){console.log("Yo, isbn13 in the house!");var z=S.isbn13;W(z)}Q(i)});var x=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/")).$asArray();if(o.arrCollections=x,x.$loaded().then(function(){}),i){var J={},Y=r(i.uid);Y.$loaded().then(function(){o.profile=Y,console.log("profile collections"),console.log(Y.collections),Y.collections&&(J=Y.collections)});var q=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(i.uid).child("collections")),G=q.$asArray();G.$loaded().then(function(){console.log("userCollectionArray length is "+G.length),o.userCollectionArray=G});var Q=function(e){b=!0,o.isBookmarking=b;var i=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(e.uid);i.child("collections/bookshelf").once("value",function(e){var i=null!==e.val();if(i){var l=[];l=e.val(),o.bookshelf=e.val(),l=d(l,o.book.$id),console.log("userCollection length is: "+l.length),l.length?(console.log("in collection and their collection is"),console.log(l),console.log("adding to sceope"),z=!0,o.inCollection=z):(console.log("not in collection and their collection is"),console.log(l),z=!1,o.inCollection=z)}b=!1,o.isBookmarking=b})}}var V=function(e){o.isLoadingAmazon=!0,amazonObj=function(e){var i=e[0];console.log(i),i.ItemAttributes.Title.length?(o.amazonData=i,o.isLoadingAmazon=!1,o.hasAmazon=!0,o.noAmazon=!1):(o.noAmazon=!0,o.isLoadingAmazon=!1)},t.get(e,amazonObj)},W=function(e){o.isLoadingApple=!0,a.lookupIsbn(e).then(function(e){if(e.data){console.log("has data"),console.log("take a bite of this lovely apple:"),console.log(e.data);var i=e.data.results[0];o.appleData=i,o.isLoadingApple=!1,o.hasApple=!0,o.noApple=!1}else o.isLoadingApple=!1,o.noApple=!0})},Z=function(e){o.isLoadingApple=!0,a.lookupId(e).then(function(e){if(e.data){console.log("has data"),console.log("take a bite of this lovely apple:"),console.log(e.data);var i=e.data.results[0];o.appleData=i,o.isLoadingApple=!1,o.hasApple=!0,o.noApple=!1}else o.isLoadingApple=!1,o.noApple=!0})};i&&p(i.uid),o.collectionsAdd=function(e,l,n){b=!0,o.isBookmarking=b;var c=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(i.uid).child("collections");c.child(n).child("books").child(L).once("value",function(o){var l=null!==o.val();l?H(i,e,n):K(i,e,n)}),o.isAdding=!0,o.isAdded=!1};var H=function(e,i,l){if(b=!0,console.log(e+i+L+l),L){var n=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(e.uid).child("collections");n.child(l).child("books").child(L).remove(),z=!1,o.inCollection=z,b=!1}o.isBookmarking=b},K=function(e,i,l){b=!0;var n=(new Date).valueOf();if(L){var c=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(e.uid).child("collections");c.child(l).child("books").child(L).update({bookid:L,description:S.description,coverUrl:S.coverurl,title:S.title,timestamp:n,addedToCollectionDate:n,addedToCollectionBy:e.uid}),c.child(l).update({timestamp:n,updatedAt:n,updatedBy:e.uid,isPublic:!1}),z=!0,o.inCollection=z,b=!1}o.isBookmarking=b},X=function(e){var i="http://api.geonames.org/neighboursJSON?&lang=en&style=medium&maxRows=15&type=json&username=thirdman&geonameId="+e,l=t.get(i,function(e){angular.forEach(e.geonames,function(e){I.push(e),o.neighbourCountries=I}),eo()})},oo=[],eo=function(){E.$loaded().then(function(){I.length&&angular.forEach(I,function(e){var i=d(E,e.countryId);i.length&&(e.countryBooks=i,oo.push(e)),o.neighbourRelatedBooks=oo})})},io=new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/");io.once("value",function(e){var i=null!==e.val();o.refCollections=e.val(),i&&console.log(o.refCollections)}),o.showCreateCollection=function(){o.newColl={},collectionAdded=!1,o.collectionAdded=collectionAdded,collectionProcessing=!1,o.collectionProcessing=!1,R=!0,o.collectionShowCreate=!0},o.showCollections=function(){R=!1,o.collectionShowCreate=!1},o.createNewCollection=function(e){var l=(new Date).valueOf();if(collectionProcessing=!0,o.collectionProcessing=!0,e.title){e.description||(e.description=""),e.imgUrl||(e.imgUrl=""),e.isPublic||(e.isPublic=!1);var n="https://sweltering-fire-3219.firebaseio.com",c=new Firebase(n).child("collections"),s=new Firebase(n).child("users").child(i.uid).child("collections"),t=c.push({title:e.title,createdBy:i.uid,createdByName:Y.displayName,description:e.description,imgUrl:e.imgUrl,timestamp:l,isPublic:e.isPublic}),a=t.name();s.child(a).set({collectionId:a,title:e.title,createdBy:i.uid,createdByName:Y.displayName,description:e.description,imgUrl:e.imgUrl,timestamp:l,isPublic:e.isPublic}),collectionAdded=!0,o.collectionAdded=collectionAdded,collectionProcessing=!1,o.collectionProcessing=!1,R=!1,o.collectionShowCreate=!1}else collectionProcessing=!1,o.collectionProcessing=!1},o.toggleBookInCollection=function(o,e,i){console.log("This is the toggle"),console.log("collectionId: "+o),console.log("collectionsArrayIndex: "+e),console.log("theAction "+i),"remove"==i?removeABook(o,e):"add"==i&&addABook(o,e)},addABook=function(e,l){var n=(new Date).valueOf();if(console.log(Y),bookProcessing=!0,o.bookProcessing=!0,console.log(S),e){var c="https://sweltering-fire-3219.firebaseio.com",s=new Firebase(c).child("collections").child(e),t=new Firebase(c).child("users").child(i.uid).child("collections").child(e),a=s.child("books").child(L).update({bookid:S.$id,title:S.title,description:S.description,coverUrl:S.coverurl,addedToCollectionByName:Y.displayName,addedToCollectionById:i.uid,addedToCollectionDate:n});t.child("books").child(L).update({bookid:S.$id,title:S.title,description:S.description,coverUrl:S.coverurl,addedToCollectionByName:Y.displayName,addedToCollectionById:i.uid,addedToCollectionDate:n}),bookProcessing=!1,o.bookProcessing=!1}},removeABook=function(e,l){if(console.log("removing book to collection"),bookProcessing=!0,o.bookProcessing=!0,e){var n="https://sweltering-fire-3219.firebaseio.com",c=new Firebase(n).child("collections").child(e),s=new Firebase(n).child("users").child(i.uid).child("collections").child(e),t=function(o){console.log(o?"Removing failed failed":"Removing succeeded")};c.child("books").child(L).remove(t),s.child("books").child(L).remove(t),bookRemoved=!0,o.collectionsArray[l].hasThisBook=0,console.log(o.collectionsArray[l]),o.bookRemoved=bookRemoved,bookProcessing=!1,o.bookProcessing=!1}},o.addBookToCollection=function(e){console.log("adding book to collection"),console.log(e),console.log(L);var l=(new Date).valueOf();if(console.log(Y),bookProcessing=!0,o.bookProcessing=!0,console.log(S),e){var n="https://sweltering-fire-3219.firebaseio.com",c=new Firebase(n).child("collections").child(e),s=new Firebase(n).child("users").child(i.uid).child("collections").child(e),t=c.child("books").child(L).update({bookid:S.$id,title:S.title,description:S.description,coverUrl:S.coverurl,addedToCollectionByName:Y.displayName,addedToCollectionById:i.uid,addedToCollectionDate:l});s.child("books").child(L).update({bookid:S.$id,title:S.title,description:S.description,coverUrl:S.coverurl,addedToCollectionByName:Y.displayName,addedToCollectionById:i.uid,addedToCollectionDate:l}),bookProcessing=!1,o.bookProcessing=!1,console.log(N)}},o.removeBookFromCollection=function(e){console.log("removing book to collection");var l=o.collectionsArray;if(bookProcessing=!0,o.bookProcessing=!0,e){var n="https://sweltering-fire-3219.firebaseio.com",c=new Firebase(n).child("collections").child(e),s=new Firebase(n).child("users").child(i.uid).child("collections").child(e),t=function(o){console.log(o?"Removing failed failed":"Removing succeeded")};c.child("books").child(L).remove(t),s.child("books").child(L).remove(t),bookRemoved=!0,o.bookRemoved=bookRemoved,bookProcessing=!1,o.bookProcessing=!1,console.log(l)}},o.clickToOpen=function(){collectionAdded=!1,o.collectionAdded=collectionAdded,collectionProcessing=!1,o.collectionProcessing=!1;var e=[],n=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(i.uid).child("collections"),c=l(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(i.uid).child("collections")).$asArray();c.$loaded().then(function(){o.collArr=c,angular.forEach(c,function(o){tempBooksArray=[];var i=S.bookid;if(o.books){var l=d(o.books,{bookid:L}).length;angular.forEach(o.books,function(o){tempBooksArray.push(o)})}else var l=!1;o.bookCount=tempBooksArray.length,o.hasThisBook=l,e.push(o)}),o.collectionsArray=e}),g.open({plain:!1,template:"views/dialogs/dialogCollections.html",scope:o})}}]);
//# sourceMappingURL=./backup-min.js.map