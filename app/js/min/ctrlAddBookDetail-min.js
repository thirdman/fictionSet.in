app.controller("AddBookDetailCtrl",["fsConfig","$scope","Auth","currentUser","$routeParams","$location","filterFilter","DataSource","$q","$http","ngDialog","to_linesFilter","FsNotify","FsGet","FsNotifyWithId",function(e,o,t,a,i,n,s,l,r,c,m,d,p,u,g){"use strict";var h=!1;h=e.DEV_STATUS;var v={},D=[],E=[],k=[],w=null;o.amazonDescHtml="",o.userComment="",o.newSetting=null,o.tempExcerpts=E,o.newExcerpt=null,o.tempBook=v,o.tempPlaces=D,o.tempTags=k,o.amazonid=i.amazonid,o.hasData=!1,o.isLooking=!0,o.isSaving=!1,o.errorPlaces=!1;var B=t.$getAuth();o.authData=B;var z=new Firebase(e.FIREBASE_URL);if(B){var A=u.getUser1(B.uid);A.$loaded().then(function(e){o.profile=e,e=e;var t=e.displayName;o.userName=t})}var f="http://fictionset.in/admin/amazon/amazon_getBook.php?search="+i.amazonid,b=function(e){var t=e[0];return o.isLooking=!0,o.hasData=!0,o.amazonData=t,t.ItemAttributes.Title.length?(o.hasData=!0,o.amazonData=t,o.hasData=!0,console.log("amazon data is..."),console.log(t),void(t.EditorialReviews?t.EditorialReviews.EditorialReview[0]?(o.theDesc=d(t.EditorialReviews.EditorialReview[0].Content),o.amazonDescHtml=t.EditorialReviews.EditorialReview[0].Content):t.EditorialReviews.EditorialReview.Content?(o.theDesc=d(t.EditorialReviews.EditorialReview.Content),o.amazonDescHtml=t.EditorialReviews.EditorialReview.Content):(o.theDesc="",o.amazonDescHtml=""):o.amazonDescHtml="")):"no data"};l.get(f,b),o.saveBook=function(){if(D.length){console.log("has places: "),console.log(D),o.errorPlaces=!1,o.tempBook.title=o.amazonData.ItemAttributes.Title,o.amazonData.ItemAttributes.Author&&(o.tempBook.author=o.amazonData.ItemAttributes.Author),o.amazonData.ItemAttributes.PublicationDate&&(o.tempBook.publicationDate=o.amazonData.ItemAttributes.PublicationDate),o.amazonData.ItemAttributes.Publisher&&(o.tempBook.publisher=o.amazonData.ItemAttributes.Publisher),o.amazonData.ItemAttributes.ISBN&&(o.tempBook.isbn=o.amazonData.ItemAttributes.ISBN),o.amazonData.ItemAttributes.EAN&&(o.tempBook.isbn13=o.amazonData.ItemAttributes.EAN),o.amazonData.EditorialReviews&&(o.amazonData.EditorialReviews.EditorialReview[0]&&(o.tempBook.description=o.amazonData.EditorialReviews.EditorialReview[0].Content),o.amazonData.EditorialReviews.EditorialReview[1]&&(o.tempBook.amazonreview=o.amazonData.EditorialReviews.EditorialReview[1].Content)),o.tempBook.description=o.theDesc,o.tempBook.amazonDescHtml=o.amazonDescHtml,o.tempBook.coverurl=o.amazonData.LargeImage.URL,o.tempBook.amazon_id=o.amazonid;var e=(new Date).valueOf();o.tempBook.timestamp=e,o.tempBook.addedById=a.uid,o.userName?o.tempBook.addedByName=o.userName:a.displayName?o.tempBook.addedByName=a.displayName:o.tempBook.addedByName="Anonymous User",o.tempBook.userComment=o.userComment;var t=o.tempBook;if(console.log(t),t=angular.copy(t),o.tempBook.places=D,o.tempBook.excerpts=E,o.tempBook.tags=k,h===!1){console.log("DEV_STATUS is"+h),o.isSaving=!0;var i=z.child("Books"),s=z.child("tags"),l=z.child("places"),r=z.child("excerpts1"),c=i.push(t),m=c.key(),d=o.tempPlaces;d=angular.copy(d),angular.forEach(d,function(e){e=angular.copy(e),i.child(m).child("places").child(e.geonameId).set(e),l.child(e.geonameId).set(e)});var p=o.tempTags;p=angular.copy(p),angular.forEach(p,function(e){i.child(m).child("tags").child(e.text).set({tagId:e.text}),s.child(e.text).child("books").push(m)});var u=o.tempExcerpts;u=angular.copy(u),i.child(m).child("excerpts").set(u),g.bookAdded(a.uid,m);var v;v=A.booksAdded?A.booksAdded:0,console.log(v),n.path(0===v?"/response/bookSuccess/"+m+"/travelguide":"/response/bookSuccess/"+m)}else console.log("DEVMODE: no actual saving. DATA USED WOULD BE:"),console.log("BOOK"),console.log(t),console.log("PLACES"),console.log(D),console.log("EXCERPTS"),console.log(E),console.log("TAGS"),console.log(k)}else console.log("does not have places"),console.log(D),o.isSaving=!1,o.errorPlaces=!0},o.addBookLocation=function(e){w=e.originalObject,D.push(w),o.newSetting=w},o.newSetting=w,o.removePlace=function(e){o.tempPlaces.splice(o.tempPlaces.indexOf(e),1),D=o.tempPlaces},o.addExcerpt=function(){console.log(o.newExcerpt),o.newExcerpt&&(E.push(o.newExcerpt),console.log(E),o.newExcerpt=null)},o.removeExcerpt=function(e){o.tempExcerpts.splice(o.tempExcerpts.indexOf(e),1),E=o.tempExcerpts},o.addTag=function(){console.log(o.newTag),o.newTag&&(k.push(o.newTag),console.log(k),o.newTag=null)},o.removeTag=function(e){o.tempTags.splice(o.tempTags.indexOf(e),1),k=o.tempTags},o.clickToOpenGuidelines=function(){m.open({plain:!1,template:"views/dialogs/dialogGuidelines.html",scope:o})}}]);
//# sourceMappingURL=./ctrlAddBookDetail-min.js.map