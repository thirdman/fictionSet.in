app.controller("NominateBookDetailCtrl",["fsConfig","$scope","currentUser","$routeParams","$location","filterFilter","DataSource","$q","$http","ngDialog","to_linesFilter","FsNotify","FsNotifyWithId",function(e,a,t,o,i,n,l,s,m,r,c,d,u){var p=!1,g={},v=[],h=[],D=[],k=null,r;a.amazonDescHtml="",a.userComment="",a.newSetting=null,a.tempExcerpts=h,a.newExcerpt=null,a.tempBook=g,a.tempPlaces=v,a.tempTags=D,a.amazonid=o.amazonid,a.hasData=!1,a.isLooking=!0,a.isSaving=!1,a.errorPlaces=!1;var z=new Firebase(e.FIREBASE_URL);if(t){var w=new Firebase(e.FIREBASE_URL+"/users/").child(t.uid);w.once("value",function(e){var t=null!==e.val(),o=e.val();a.profile=o;var i=o.displayName;a.userName=i,console.log(o.name),console.log(o)})}var B="http://fictionset.in/admin/amazon/amazon_getBook.php?search="+o.amazonid;amazonObj=function(e){var t=e[0];return a.isLooking=!0,a.hasData=!0,a.amazonData=t,t.ItemAttributes.Title.length?(a.hasData=!0,a.amazonData=t,a.hasData=!0,console.log("amazon data is..."),console.log(t),void(t.EditorialReviews?t.EditorialReviews.EditorialReview[0]?(a.theDesc=c(t.EditorialReviews.EditorialReview[0].Content),a.amazonDescHtml=t.EditorialReviews.EditorialReview[0].Content):t.EditorialReviews.EditorialReview.Content?(a.theDesc=c(t.EditorialReviews.EditorialReview.Content),a.amazonDescHtml=t.EditorialReviews.EditorialReview.Content):(a.theDesc="",a.amazonDescHtml=""):a.amazonDescHtml="")):"no data"},l.get(B,amazonObj),a.autoObject=function(e){k=e.originalObject;var t=v;v.push(k),a.newSetting=k},a.newSetting=k,a.removePlace=function(e){a.tempPlaces.splice(a.tempPlaces.indexOf(e),1),v=a.tempPlaces},a.addTag=function(){console.log(a.newTag),a.newTag&&(D.push(a.newTag),console.log(D),a.newTag=null)},a.removeTag=function(e){a.tempTags.splice(a.tempTags.indexOf(e),1),D=a.tempTags},a.saveBook=function(){if(v.length){if(console.log("has places: "),console.log(v),a.errorPlaces=!1,0==p){console.log("testMode is"+p),a.isSaving=!0,a.tempBook.title=a.amazonData.ItemAttributes.Title,a.amazonData.ItemAttributes.Author&&(a.tempBook.author=a.amazonData.ItemAttributes.Author),a.amazonData.ItemAttributes.PublicationDate&&(a.tempBook.publicationDate=a.amazonData.ItemAttributes.PublicationDate),a.amazonData.ItemAttributes.Publisher&&(a.tempBook.publisher=a.amazonData.ItemAttributes.Publisher),a.amazonData.ItemAttributes.ISBN&&(a.tempBook.isbn=a.amazonData.ItemAttributes.ISBN),a.amazonData.ItemAttributes.EAN&&(a.tempBook.isbn13=a.amazonData.ItemAttributes.EAN),a.amazonData.EditorialReviews&&(a.amazonData.EditorialReviews.EditorialReview[0]&&(a.tempBook.description=a.amazonData.EditorialReviews.EditorialReview[0].Content),a.amazonData.EditorialReviews.EditorialReview[1]&&(a.tempBook.amazonreview=a.amazonData.EditorialReviews.EditorialReview[1].Content)),a.tempBook.description=a.theDesc,a.tempBook.amazonDescHtml=a.amazonDescHtml,a.tempBook.coverurl=a.amazonData.LargeImage.URL,a.bookLink&&(a.tempBook.bookLink=a.bookLink),a.tempBook.amazon_id=a.amazonid;var e=(new Date).valueOf();a.tempBook.timestamp=e,a.tempBook.addedById=t.uid,a.userName?a.tempBook.addedByName=a.userName:t.displayName?a.tempBook.addedByName=t.displayName:a.tempBook.addedByName="Anonymous User",a.tempBook.userComment=a.userComment;var o=z.child("nominated").child("Books"),n=z.child("nominated").child("places"),l=z.child("nominated").child("tags"),s=a.tempBook;console.log(s);var s=angular.copy(s),m=o.push(s),r=m.key();a.tempBook.places=v;var c=a.tempPlaces,c=angular.copy(c);angular.forEach(c,function(e,a){e=angular.copy(e),o.child(r).child("places").child(e.geonameId).set(e),n.child(e.geonameId).set(e)});var d=a.tempTags,d=angular.copy(d);angular.forEach(d,function(e,a){o.child(r).child("tags").child(e.text).set({tagId:e.text}),l.child(e.text).child("books").push(r)});var g="Nomination",h=(new Date).valueOf(),D=a.messageAuthor,k=t.uid;u.bookSuggested(t.uid,r),i.path("/requests/")}}else console.log("does not have places"),console.log(v),a.isSaving=!1,a.errorPlaces=!0},a.clickToOpenGuidelines=function(){r.open({plain:!1,template:"views/dialogs/dialogGuidelines.html",scope:a})}}]);
//# sourceMappingURL=./ctrlNominateBookDetail-min.js.map