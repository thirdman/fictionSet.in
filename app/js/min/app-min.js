function checkIfUserExists(e){var o=new Firebase("https://sweltering-fire-3219.firebaseio.com/users");o.child(e).once("value",function(o){var t=null!==o.val();return console.log("in the check..."),console.log(e,t),t})}function distance(e,o,t,l,a){var i=Math.PI*e/180,n=Math.PI*t/180,r=Math.PI*o/180,s=Math.PI*l/180,c=o-l,u=Math.PI*c/180,d=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(u);return d=Math.acos(d),d=180*d/Math.PI,d=60*d*1.1515,"K"==a&&(d=1.609344*d),"N"==a&&(d=.8684*d),d}function arrayObjectIndexOf(e,o){for(var t=0;t<e.length;t++)if(angular.equals(e[t],o))return t;return-1}var app=angular.module("myApp",["firebase","ngRoute","myApp.directives","angular-underscore","ngLodash","angucomplete-alt","ngResource","angularMapbox","ngDialog"]);app.config(["$routeProvider","$locationProvider","ngDialogProvider",function(e,o,t){t.setDefaults({className:"ngdialog-theme-default",plain:!0,showClose:!0,closeByDocument:!0,closeByEscape:!0}),e.when("/home",{controller:"HomeCtrl",templateUrl:"views/home.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/login",{controller:"LoginCtrl",templateUrl:"views/login.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/register",{controller:"RegisterCtrl",templateUrl:"views/register.html"}).when("/about",{controller:"AboutCtrl",templateUrl:"views/about.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/account",{controller:"AccountCtrl",templateUrl:"views/account.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/profile",{controller:"ProfileCtrl",templateUrl:"views/profile.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/profile/:displayName",{controller:"ProfileCtrl",templateUrl:"views/profile.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/following",{controller:"FollowingCtrl",templateUrl:"views/following.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/book/:id",{controller:"BookCtrl",templateUrl:"views/book.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/places",{controller:"PlacesCtrl",templateUrl:"views/places.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/place/:placeid",{controller:"PlaceCtrl",templateUrl:"views/place.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/collection/:collectionid",{controller:"CollectionCtrl",templateUrl:"views/collection.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/near",{controller:"NearCtrl",templateUrl:"views/near.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/setting/:setting",{controller:"SettingCtrl",templateUrl:"views/setting.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/manageplaces/",{controller:"ManagePlacesCtrl",templateUrl:"views/admin/manageplaces.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/manageplace/:placeid/:place?",{controller:"EditPlaceCtrl",templateUrl:"views/admin/editplace.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/editbook/:id",{controller:"EditBookCtrl",templateUrl:"views/admin/editbook.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/addbook/",{controller:"AddBookCtrl",templateUrl:"views/admin/addbook.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/addbook/:amazonid",{controller:"AddBookDetailCtrl",templateUrl:"views/admin/addbookdetail.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/admin/messages",{controller:"AddMessageCtrl",templateUrl:"views/admin/managemessages.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).when("/admin/users",{controller:"ManageUsersCtrl",templateUrl:"views/admin/manageusers.html",resolve:{currentUser:["simpleLogin",function(e){return e.$getCurrentUser()}]}}).otherwise({redirectTo:"/home"})}]),app.factory("simpleLogin",["$firebaseSimpleLogin","Profile","$rootScope",function(e,o,t){var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/"),a=!0,i=!1,n,r=0,s=!1,c=new FirebaseSimpleLogin(l,function(e,o){if(e)switch(console.log(e),e.code){case"INVALID_EMAIL":console.log("invalid email");case"INVALID_PASSWORD":console.log("invalid password");default:console.log("Error")}else o?(console.log("authenticated"),console.log("User ID: "+o.uid+", Provider: "+o.provider),console.log(o),l.child("users").child(o.uid).once("value",function(e){if(console.log(null!==e.val()),i=null!==e.val(),!i){console.log("does not esixt, lets save"),"google"==o.provider?(console.log("provider is google"),n=o.thirdPartyUserData.picture):"facebook"==o.provider&&(console.log("provider is facebook"),n=o.thirdPartyUserData.picture.data.url);var t=(new Date).valueOf();l.child("users").child(o.uid).set({displayName:o.displayName,provider:o.provider,picture_url:n,provider_id:o.id,createdAt:t}),l.child("/system/messages").push({title:"User Added (simplelogin)",messageContent:o.displayName+" ("+provider+") was added.",messageType:"User",timestamp:t})}})):console.log(" not (user), so...")});return e(l)}]),app.factory("getFirebase",["$scope","$location",function(e,o){var t=new firebase("https://sweltering-fire-3219.firebaseio.com/books").once("value",function(e){var o=e.val();console.log(e.val())});return $firebase(t,tag)}]),app.factory("AuthService",["$rootScope","$location",function(e,o){return{createUser:function(o,t,l){l.logout(),l.createUser(o,t,function(o,t){o||(e.user=t)})},login:function(e,o,t){t.logout(),t.login("password",{email:e,password:o,rememberMe:!1})},logout:function(e){e.logout()}}}]),app.factory("Flickr",function(e,o){var t=e("http://api.flickr.com/services/feeds/photos_public.gne",{format:"json",jsoncallback:"JSON_CALLBACK"},{load:{method:"JSONP"}});return{search:function(e){var l=o.defer();return t.load({tags:e},function(e){l.resolve(e)},function(e){l.reject(e)}),l.promise}}}),app.factory("FlickrPlace",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.places.find&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&query=";return{getPlace:function(l){return e.get(t+l).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}),app.factory("FlickrPlacePics",function(e,o){var t="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=f33601a59d5cc2e162113d896f47474e&format=json&nojsoncallback=1&auth_token=&api_sig=&per_page=20&min_taken_date=1262304000&extras=url_m,url_s&sort=interestingness-desc&place_id=",l="&bbox="+l,a="&tags=crete",i="&is_getty=true";return{getPics:function(l,a){return e.get(t+l).then(function(e){return"object"==typeof e.data?e.data:o.reject(e.data)},function(e){return o.reject(e.data)})}}}),app.factory("DataSource",["$http",function(e){return{get:function(o,t,l){e.get(o).success(function(e,o){console.log("Request succeeded"),t(e)}).error(function(e,o){console.log("Request failed "+o)})}}}]),app.factory("iTunesData",function(e){return{doSearch:function(o){return e.jsonp("http://itunes.apple.com/search",{params:{callback:"JSON_CALLBACK",term:o}})},lookupIsbn:function(o){return e.jsonp("http://itunes.apple.com/lookup",{params:{callback:"JSON_CALLBACK",isbn:o}})},lookupId:function(o){return e.jsonp("http://itunes.apple.com/lookup",{params:{callback:"JSON_CALLBACK",id:o}})}}}),app.factory("Profile",["$firebase",function(e){return function(o){var t=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o);return e(t).$asObject()}}]),app.controller("AuthCtrl",["$scope","simpleLogin",function(e,o){e.auth=o}]),app.controller("HomeCtrl",["$scope","currentUser","$firebase","$location",function(e,o,t,l){e.hasData=!1;var a=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books"),i=t(a);list=i.$asArray(),e.list=list,list.$loaded().then(function(){e.hasData=!0})}]),app.controller("AboutCtrl",["$scope","$location","currentUser","Profile","$routeParams",function(e,o,t,l,a){try{console.log(t?"logged in":"no one is logged in")}catch(i){}}]),app.controller("BookCtrl",["$scope","currentUser","$firebase","$routeParams","$location","$timeout","DataSource","iTunesData","Profile","filterFilter","ngDialog","$log",function(e,o,t,l,a,i,n,r,s,c,u,d,g){function p(o){var t="https://sweltering-fire-3219.firebaseio.com/users",l=new Firebase(t);console.log(l),l.child(o).once("value",function(o){var t=null!==o.val(),l=o.val(),a=l.role,i=l.role>50;e.userRole=a,e.userAaa=i})}e.isLoading=!0;var f=!1;e.isBookmarking=f,e.hasData=!1,e.isLoadingAmazon=!1,e.noAmazon=!0,e.hasAmazon=!1,e.amazonData="",e.userAaa=!1,e.userRole=0,e.relatedBooks="";var m="/",h="pk.eyJ1IjoidGhpcmRtYW4iLCJhIjoidjBOQ0lrYyJ9.8zzETVcyoBg2nlMquUR1TA",v="http://api.tiles.mapbox.com/v4/thirdman.j1o1gjim",b="";e.mapUrlString=b;var w=5,k,y,A="",C="",P="",D="",U=!1,B=[],L="",F=l.id,U;e.inCollection=U,e.bookid=F,e.testContent="ggg",e.collectionFollowing=!1,e.collectionAdded=!1,e.collectionProcessing=!1;var I=!1;e.collectionShowCreate=I;var E={};e.collectionsObj=E;var R=[];e.collectionsArray=R;var S=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+F),z=t(S);e.book=z.$asObject();var N=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+F)).$asObject(),O=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray();e.bookplaces={};var j=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"),T=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+F+"/tags/0")).$asArray();N.$loaded().then(function(){if(e.hasData=!0,e.isLoading=!1,N.amazon_id.length){var t="http://fictionset.in/admin/amazon/amazon_getBook.php?search="+N.amazon_id;K(t)}if(j.once("value",function(e){var o=e.val()}),N.places){var l=[];l=N.places,e.bookPlaces=l;var a=!0,i=0,n="",r=[];angular.forEach(l,function(o){""==C?(A=o.lat,C=o.lat):(o.lat>A&&(A=o.lat),o.lat<C&&(C=o.lat)),""==D?(P=o.lng,D=o.lng):(o.lat>P&&(P=o.lng),o.lat<D&&(D=o.lng));var t="pin-m-library+222("+o.lng+","+o.lat+")";"/"==m?m+=t:m=m+","+t,n!=o.countryId&&(console.log("Locations is not from the same country"),n=o.countryId,r.push(o)),a&&(k=o.lat,y=o.lng,e.bkLng=y,e.bkLat=k,1==i&&(a=!1)),i+=1}),A=parseFloat(A),C=parseFloat(C),P=parseFloat(P),D=parseFloat(D);var s=Math.abs(C-A),u=Math.abs(D-P),d=Math.abs(P-A)/2,g=Math.abs(D-C)/2;w=10>d?8:30>d?5:60>d?3:80>d?2:1,console.log(w),w=10>g?8:30>g?6:60>g?4:60>g?3:140>g?2:1,console.log("bkZoom:"+w),k=(A+C)/2,y=(P+D)/2;var p=v+m,f="/"+y+","+k+","+w+"/1200x300.png?access_token="+h,b=p+f;e.mapUrlString=b;var U=[];O.$loaded().then(function(){angular.forEach(r,function(o){Q(o.countryId);var t=c(O,o.countryId);console.log(t),o.countryBooks=t,U.push(o),e.relatedBooks=U})})}else e.bkLng="100",e.bkLat="0";if(N.apple_id){console.log("Yo, apple id already here");var B=N.apple_id;Y(B)}else if(N.isbn13){console.log("Yo, isbn13 in the house!");var B=N.isbn13;V(B)}J(o)});var _=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/")).$asArray();if(e.arrCollections=_,_.$loaded().then(function(){}),o){var M={},x=s(o.uid);x.$loaded().then(function(){e.profile=x,console.log("profile collections"),console.log(x.collections),x.collections&&(M=x.collections)});var H=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid).child("collections")),q=H.$asArray();q.$loaded().then(function(){console.log("userCollectionArray length is "+q.length),e.userCollectionArray=q});var J=function(o){f=!0,e.isBookmarking=f;var t=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid);t.child("collections/bookshelf").once("value",function(o){var t=null!==o.val();if(t){var l=[];l=o.val(),e.bookshelf=o.val(),l=c(l,e.book.$id),console.log("userCollection length is: "+l.length),l.length?(console.log("in collection and their collection is"),console.log(l),console.log("adding to sceope"),U=!0,e.inCollection=U):(console.log("not in collection and their collection is"),console.log(l),U=!1,e.inCollection=U)}f=!1,e.isBookmarking=f})}}var K=function(o){e.isLoadingAmazon=!0,amazonObj=function(o){var t=o[0];console.log(t),t.ItemAttributes.Title.length?(e.amazonData=t,e.isLoadingAmazon=!1,e.hasAmazon=!0,e.noAmazon=!1):(e.noAmazon=!0,e.isLoadingAmazon=!1)},n.get(o,amazonObj)},V=function(o){e.isLoadingApple=!0,r.lookupIsbn(o).then(function(o){if(o.data){console.log("has data"),console.log("take a bite of this lovely apple:"),console.log(o.data);var t=o.data.results[0];e.appleData=t,e.isLoadingApple=!1,e.hasApple=!0,e.noApple=!1}else e.isLoadingApple=!1,e.noApple=!0})},Y=function(o){e.isLoadingApple=!0,r.lookupId(o).then(function(o){if(o.data){console.log("has data"),console.log("take a bite of this lovely apple:"),console.log(o.data);var t=o.data.results[0];e.appleData=t,e.isLoadingApple=!1,e.hasApple=!0,e.noApple=!1}else e.isLoadingApple=!1,e.noApple=!0})};o&&p(o.uid),e.collectionsAdd=function(t,l,a){f=!0,e.isBookmarking=f;var i=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(o.uid).child("collections");i.child(a).child("books").child(F).once("value",function(e){var l=null!==e.val();l?G(o,t,a):W(o,t,a)}),e.isAdding=!0,e.isAdded=!1};var G=function(o,t,l){if(f=!0,console.log(o+t+F+l),F){var a=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(o.uid).child("collections");a.child(l).child("books").child(F).remove(),U=!1,e.inCollection=U,f=!1}e.isBookmarking=f},W=function(o,t,l){f=!0;var a=(new Date).valueOf();if(F){var i=new Firebase("https://sweltering-fire-3219.firebaseio.com").child("users").child(o.uid).child("collections");i.child(l).child("books").child(F).update({bookid:F,description:N.description,coverUrl:N.coverurl,title:N.title,timestamp:a,addedToCollectionDate:a,addedToCollectionBy:o.uid}),i.child(l).update({timestamp:a,updatedAt:a,updatedBy:o.uid,isPublic:!1}),U=!0,e.inCollection=U,f=!1}e.isBookmarking=f},Q=function(o){var t="http://api.geonames.org/neighboursJSON?&lang=en&style=medium&maxRows=15&type=json&username=thirdman&geonameId="+o,l=n.get(t,function(o){angular.forEach(o.geonames,function(o){B.push(o),e.neighbourCountries=B}),X()})},Z=[],X=function(){O.$loaded().then(function(){B.length&&angular.forEach(B,function(o){var t=c(O,o.countryId);t.length&&(o.countryBooks=t,Z.push(o)),e.neighbourRelatedBooks=Z})})},eo=new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/");eo.once("value",function(o){var t=null!==o.val();e.refCollections=o.val(),t&&console.log(e.refCollections)}),e.showCreateCollection=function(){e.newColl={},collectionAdded=!1,e.collectionAdded=collectionAdded,collectionProcessing=!1,e.collectionProcessing=!1,I=!0,e.collectionShowCreate=!0},e.showCollections=function(){I=!1,e.collectionShowCreate=!1},e.createNewCollection=function(t){var l=(new Date).valueOf();if(collectionProcessing=!0,e.collectionProcessing=!0,t.title){t.description||(t.description=""),t.imgUrl||(t.imgUrl=""),t.isPublic||(t.isPublic=!1);var a="https://sweltering-fire-3219.firebaseio.com",i=new Firebase(a).child("collections"),n=new Firebase(a).child("users").child(o.uid).child("collections"),r=i.push({title:t.title,createdBy:o.uid,createdByName:x.displayName,description:t.description,imgUrl:t.imgUrl,timestamp:l,isPublic:t.isPublic}),s=r.name();n.child(s).set({collectionId:s,title:t.title,createdBy:o.uid,createdByName:x.displayName,description:t.description,imgUrl:t.imgUrl,timestamp:l,isPublic:t.isPublic}),collectionAdded=!0,e.collectionAdded=collectionAdded,collectionProcessing=!1,e.collectionProcessing=!1,I=!1,e.collectionShowCreate=!1}else collectionProcessing=!1,e.collectionProcessing=!1},e.toggleBookInCollection=function(e,o,t){console.log("This is the toggle"),console.log("collectionId: "+e),console.log("collectionsArrayIndex: "+o),console.log("theAction "+t),"remove"==t?removeABook(e,o):"add"==t&&addABook(e,o)},addABook=function(t,l){var a=(new Date).valueOf();if(console.log(x),bookProcessing=!0,e.bookProcessing=!0,console.log(N),t){var i="https://sweltering-fire-3219.firebaseio.com",n=new Firebase(i).child("collections").child(t),r=new Firebase(i).child("users").child(o.uid).child("collections").child(t),s=n.child("books").child(F).update({bookid:N.$id,title:N.title,description:N.description,coverUrl:N.coverurl,addedToCollectionByName:x.displayName,addedToCollectionById:o.uid,addedToCollectionDate:a});r.child("books").child(F).update({bookid:N.$id,title:N.title,description:N.description,coverUrl:N.coverurl,addedToCollectionByName:x.displayName,addedToCollectionById:o.uid,addedToCollectionDate:a}),bookProcessing=!1,e.bookProcessing=!1}},removeABook=function(t,l){if(console.log("removing book to collection"),bookProcessing=!0,e.bookProcessing=!0,t){var a="https://sweltering-fire-3219.firebaseio.com",i=new Firebase(a).child("collections").child(t),n=new Firebase(a).child("users").child(o.uid).child("collections").child(t),r=function(e){console.log(e?"Removing failed failed":"Removing succeeded")};i.child("books").child(F).remove(r),n.child("books").child(F).remove(r),bookRemoved=!0,e.collectionsArray[l].hasThisBook=0,console.log(e.collectionsArray[l]),e.bookRemoved=bookRemoved,bookProcessing=!1,e.bookProcessing=!1}},e.addBookToCollection=function(t){console.log("adding book to collection"),console.log(t),console.log(F);var l=(new Date).valueOf();if(console.log(x),bookProcessing=!0,e.bookProcessing=!0,console.log(N),t){var a="https://sweltering-fire-3219.firebaseio.com",i=new Firebase(a).child("collections").child(t),n=new Firebase(a).child("users").child(o.uid).child("collections").child(t),r=i.child("books").child(F).update({bookid:N.$id,title:N.title,description:N.description,coverUrl:N.coverurl,addedToCollectionByName:x.displayName,addedToCollectionById:o.uid,addedToCollectionDate:l});n.child("books").child(F).update({bookid:N.$id,title:N.title,description:N.description,coverUrl:N.coverurl,addedToCollectionByName:x.displayName,addedToCollectionById:o.uid,addedToCollectionDate:l}),bookProcessing=!1,e.bookProcessing=!1,console.log(R)}},e.removeBookFromCollection=function(t){console.log("removing book to collection");var l=e.collectionsArray;if(bookProcessing=!0,e.bookProcessing=!0,t){var a="https://sweltering-fire-3219.firebaseio.com",i=new Firebase(a).child("collections").child(t),n=new Firebase(a).child("users").child(o.uid).child("collections").child(t),r=function(e){console.log(e?"Removing failed failed":"Removing succeeded")};i.child("books").child(F).remove(r),n.child("books").child(F).remove(r),bookRemoved=!0,e.bookRemoved=bookRemoved,bookProcessing=!1,e.bookProcessing=!1,console.log(l)}},e.clickToOpen=function(){collectionAdded=!1,e.collectionAdded=collectionAdded,collectionProcessing=!1,e.collectionProcessing=!1;var l=[],a=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid).child("collections"),i=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid).child("collections")).$asArray();i.$loaded().then(function(){e.collArr=i,angular.forEach(i,function(e){tempBooksArray=[];var o=N.bookid;if(e.books){var t=c(e.books,{bookid:F}).length;angular.forEach(e.books,function(e){tempBooksArray.push(e)})}else var t=!1;e.bookCount=tempBooksArray.length,e.hasThisBook=t,l.push(e)}),e.collectionsArray=l}),u.open({plain:!1,template:"views/dialogs/dialogCollections.html",scope:e})}}]),app.controller("SettingCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter",function(e,o,t,l,a,i){console.log(e);var n=l.setting;e.settingtag=n;var r=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"),s=null,c=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray();c.$loaded().then(function(){console.log(c),e.setting=i(c,{tags:n}),console.log(e.setting)}),e.setting=s}]),app.controller("PlaceCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource","FlickrPlacePics","FlickrPlace","$timeout","ngDialog","Profile",function(e,o,t,l,a,i,n,r,s,c,u,d){function g(o){var t="https://sweltering-fire-3219.firebaseio.com/users",l=new Firebase(t);console.log(l),l.child(o).once("value",function(o){var t=null!==o.val(),l=o.val(),a=l.role,i=l.role>50;e.userRole=a,e.userAaa=i})}var p=l.placeid;e.placeid=p,e.isLoading=!0;var f=null,m=null,h="";e.userAaa=!1,e.othername=null,e.isFollowing=!1,e.followProcessing=!1;var v=null,b=null;if(e.userfollowingList=null,o)var w=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid);var k=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"),y=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"+p),A=null,C=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"+p+"/images/")).$asArray();C.$loaded().then(function(){console.log(C),e.placeImages=C});var P=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"+p)).$asObject();P.$loaded().then(function(){console.log("placeobj.geonameId is..."),console.log(P.geonameId),P.geonameId?console.log("we have a geonameId"):(console.log("we dont have a geonameId"),m=P.$id,e.othername=P.$id),console.log(P),e.placeInfo=P;var l=P.$id;if(P.geonameId&&(l=P.name+" "+P.countryName),o){var a=[],n=d(o.uid);n.$loaded().then(function(){if(e.profile=n,console.log(e.profile),console.log(n.following),n.following){a=n.following;var o=i(a,{placeid:p});o.length&&(e.isFollowing=!0)}})}e.stopFollowing=function(){var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid).child("/following/");e.removeItemList=t(l),removeItemList=e.removeItemList,removeItemList.$remove(p),e.isFollowing=!1};var c=function(o){s.getPlace(o).then(function(e){return console.log("data is returned"),console.log(e),e.places.place[0].place_id;console.log(""!=e.places.place[0].place_id?e.places.place[0].place_id:e.places.place[0].place_id)},function(e){console.log("promise rejected")}).then(function(o,t){console.log("OK, now we have an id, lets get some pics"),console.log(o),r.getPics(o).then(function(o){return console.log("now we have some photos! (in resp/scope.photos"),e.photos=o.photos.photo,console.log(e.photos),o})})}});var D=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray();D.$loaded().then(function(){console.log(D),e.thePlace=i(D,{places:p}),console.log(e.thePlace),e.isLoading=!1}),e.placeInfo=f,e.thePlace=A,v="123",e.flickrPhotoSet=v,e.flickrPhotoArray=b,e.clickToOpen=function(){u.open({plain:!1,template:"views/dialogs/dialogFollowPlace.html",scope:e})},e.followPlace=function(t,l){console.log(o),console.log(P),t?(e.followProcessing=!0,w.child("following").child(t).update({placeid:t,name:P.name,countryId:P.countryId,countryName:P.countryName}),e.isFollowing=!0,e.followProcessing=!1,console.log("done")):(e.isFollowing=!1,e.followProcessing=!1)},e.closeThisDialog=function(e){console.log("it was closed and the value that was passed was..."),console.log(e)},o&&g(o.uid)}]),app.controller("PlacesCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","$filter","DataSource",function(e,o,t,l,a,i,n,r){e.isLoading=!0;var s=null,c=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray(),u=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/places/")).$asArray(),d=[];u.$loaded().then(function(){e.placeList=u,e.filterBy=c,c.$loaded().then(function(){e.booksList=c,u.$loaded().then(function(){angular.forEach(u,function(e){var o=i(c,{places:e.geonameId});o.length?(e.bookCount=o.length,e.books=o,d.push(e)):(e.bookCount=0,d.push(e))})}),e.filteredPlaces=function(){return e.placeList.filter(function(o){console.log(o),console.log(o.geonameId),console.log(i(e.filterBy,{places:o.geonameId}));var t=i(e.filterBy,{places:o.geonameId});return t})}}),e.isLoading=!1}),e.placeList=s,e.placesArray=d}]),app.controller("NearCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource",function(e,o,t,l,a,i,n){e.isLoading=!0,e.isLoadingPlaces=!0,e.isLoadingBooks=!0;var r=null,s=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"),c=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/places/")).$asArray();c.$loaded().then(function(){e.placeList=c}),e.placeList=r,e.mgLocation="Finding location...",navigator.geolocation.getCurrentPosition(function(e){d(e.coords.latitude,e.coords.longitude),u(),{timeout:1e4}});var u=function(){console.log("error getting location"),e.isLoading=!1,e.isLoadingPlaces=!1,e.isLoadingBooks=!1},d=function(o,t){if(o){e.msgLocation="Calculated GPS location is "+o+", "+t;var l=o,a=t;g(l,a),e.userLat=o,e.userLat=t;var i="http://api.geonames.org/findNearby?&lang=en&style=medium&maxRows=5&type=json&username=thirdman&lat="+o+"&lng="+t,r=n.get(i,function(o){var t=[],t=o.geonames,i=o.geonames[0];console.log(i),e.userCountry=i.countryName,e.msgLocation="You appear to be in "+i.name+", "+i.countryName+". The closest 10 places are:";var n=e.placeList;if(e.distList=e.placeList,n.length){console.log("got length");var r=[];angular.forEach(n,function(e){var o=distance(l,a,e.lat,e.lng,"K");e.distanceAway=o,r.push(e)}),e.distListitems=r,console.log(e.distListitems)}});e.isLoading=!1,e.isLoadingPlaces=!1}else e.mgLocation="Location Data Unavailable"},g=function(o,l){var o=o,l=l;e.booksMsg="Hunting books.";var a=null,i=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/")).$asArray();i.$loaded().then(function(){e.booksMsg="Books found. Calculating....";var t=i;e.theBooks=i;var a=[];angular.forEach(t,function(e){var t=[],i=null!==e.places;i&&(t=e.places,e.closestDistance=99999999999990,e.closestPlaceName="nada",angular.forEach(t,function(t){itemClosestDistance=e.closestDistance;var a=distance(o,l,t.lat,t.lng,"K");if(a<e.closestDistance){var i=a,n=t.name;e.closestDistance=i,e.closestPlaceName=n}t.distanceAway=a}),a.push(e))}),e.booksMsg="The 10 books with closest locations are:",e.booksByDistance=a,console.log("books by distance is"),console.log(e.booksByDistance)}),e.theBooks=a,e.isLoading=!1,e.isLoadingBooks=!1}}]),app.controller("CollectionCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","ngDialog","Profile",function(e,o,t,l,a,i,n,r){var s,c,s=l.collectionid;if(e.placeid=s,o)var u=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid);var d=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/"+s)).$asObject(),g=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/collections/"+s+"/books/")).$asArray();g.$loaded().then(function(){var o=0;g.forEach(function(){o++}),e.bookCount=o}),d.$loaded().then(function(){var o=d;e.theCollection=d})}]),app.controller("AddBookCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource","$q","$http",function(e,o,t,l,a,i,n,r,s){e.hasData=!1,e.isLooking=!1;var c=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/");e.searchBooks=function(){e.hasData=!1,e.isLooking=!0;var o="http://fictionset.in/admin/amazon/amazon_searchbooks.php?search="+e.searchString;searchData=function(o){e.isLooking=!1,e.hasData=!0,e.dataSearch=o,console.log(o)},n.get(o,searchData)}}]),app.controller("AddBookDetailCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource","$q","$http","to_linesFilter",function(e,o,t,l,a,i,n,r,s,c){var u={},d=[],g=[],p=[],f=null;e.amazonDescHtml="",e.userComment="",e.newSetting=null,e.tempExcerpts=g,e.newExcerpt=null,e.tempBook=u,e.tempPlaces=d,e.tempTags=p,e.amazonid=l.amazonid,e.hasData=!1,e.isLooking=!0,e.isSaving=!1;var m=new Firebase("https://sweltering-fire-3219.firebaseio.com/");if(o){var h=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid);h.once("value",function(o){var t=null!==o.val(),l=o.val();e.profile=l;var a=l.name;e.userName=a,console.log(l.name)})}var v="http://fictionset.in/admin/amazon/amazon_getBook.php?search="+l.amazonid;amazonObj=function(o){var t=o[0];return e.isLooking=!0,e.hasData=!0,console.log(t),e.amazonData=t,t.ItemAttributes.Title.length?(e.hasData=!0,e.amazonData=t,e.hasData=!0,console.log("amazon data is..."),console.log(t),t.EditorialReviews?t.EditorialReviews.EditorialReview[0]?(e.theDesc=c(t.EditorialReviews.EditorialReview[0].Content),e.amazonDescHtml=t.EditorialReviews.EditorialReview[0].Content):t.EditorialReviews.EditorialReview.Content?(e.theDesc=c(t.EditorialReviews.EditorialReview.Content),e.amazonDescHtml=t.EditorialReviews.EditorialReview.Content):(e.theDesc="",e.amazonDescHtml=""):e.amazonDescHtml="",void console.log(e.amazonDescHtml)):"no data"},n.get(v,amazonObj),e.autoObject=function(o){console.log(o),f=o.originalObject,console.log(f);var t=d;d.push(f),console.log(f),console.log(e.tempPlaces),e.newSetting=f},e.newSetting=f,e.removePlace=function(o){e.tempPlaces.splice(e.tempPlaces.indexOf(o),1),d=e.tempPlaces},e.addExcerpt=function(){console.log(e.newExcerpt),e.newExcerpt&&(g.push(e.newExcerpt),console.log(g),e.newExcerpt=null)},e.removeExcerpt=function(o){e.tempExcerpts.splice(e.tempExcerpts.indexOf(o),1),g=e.tempExcerpts},e.addTag=function(){console.log(e.newTag),e.newTag&&(p.push(e.newTag),console.log(p),e.newTag=null)},e.removeTag=function(o){e.tempTags.splice(e.tempTags.indexOf(o),1),p=e.tempTags},e.saveBook=function(){e.isSaving=!0,e.tempBook.title=e.amazonData.ItemAttributes.Title,e.amazonData.ItemAttributes.Author&&(e.tempBook.author=e.amazonData.ItemAttributes.Author),e.amazonData.ItemAttributes.PublicationDate&&(e.tempBook.publicationDate=e.amazonData.ItemAttributes.PublicationDate),e.amazonData.ItemAttributes.Publisher&&(e.tempBook.publisher=e.amazonData.ItemAttributes.Publisher),e.amazonData.ItemAttributes.ISBN&&(e.tempBook.isbn=e.amazonData.ItemAttributes.ISBN),e.amazonData.ItemAttributes.EAN&&(e.tempBook.isbn13=e.amazonData.ItemAttributes.EAN),e.amazonData.EditorialReviews&&(e.amazonData.EditorialReviews.EditorialReview[0]&&(e.tempBook.description=e.amazonData.EditorialReviews.EditorialReview[0].Content),e.amazonData.EditorialReviews.EditorialReview[1]&&(e.tempBook.amazonreview=e.amazonData.EditorialReviews.EditorialReview[1].Content)),e.tempBook.description=e.theDesc,e.tempBook.amazonDescHtml=e.amazonDescHtml,e.tempBook.coverurl=e.amazonData.LargeImage.URL,e.tempBook.amazon_id=e.amazonid;var t=(new Date).valueOf();e.tempBook.timestamp=t,e.tempBook.addedById=o.uid,e.tempBook.addedByName=e.userName?e.userName:o.displayName?o.displayName:"Anonymous User",e.tempBook.userComment=e.userComment;var l=m.child("Books"),i=m.child("tags"),n=m.child("places"),r=m.child("excerpts1"),s=e.tempBook;console.log(s);var s=angular.copy(s),c=l.push(s),u=c.name();e.tempBook.places=d,e.tempBook.excerpts=g,e.tempBook.tags=p;var f=e.tempPlaces,f=angular.copy(f);angular.forEach(f,function(e,o){e=angular.copy(e),l.child(u).child("places").child(e.geonameId).set(e),n.child(e.geonameId).set(e)});var h=e.tempTags,h=angular.copy(h);angular.forEach(h,function(e,o){l.child(u).child("tags").child(e.tagName).set(e),i.child(e.tagName).child("books").push(u)});var v=e.tempExcerpts,v=angular.copy(v);l.child(u).child("excerpts").set(v);var b=(new Date).valueOf();m.child("/system/messages").push({title:"Book Added",messageContent:e.tempBook.title+" was added",messageType:"Book",timestamp:b}),a.path("#/book/:"+u)}}]),app.controller("DialogFollowPlaceCtrl",["$scope","$location","ngDialog",function(e,o,t){console.log("loaded controller"),console.log(e.$parent)}]),app.controller("DialogCollectionsAdd",["$scope","$location","ngDialog","simpleLogin",function(e,o,t,l){var a=l.$getCurrentUser();
e.testContent=a.uid,console.log("loaded controller"),console.log(e.$parent),console.log(e),console.log(e.$id),console.log(bookid),console.log(a)}]),app.controller("LoginCtrl",["$scope","$location","currentUser","simpleLogin",function(e,o,t,l){try{t?(console.log("logged in"),e.$apply(function(){o.path("/account")})):console.log("no one is logged in")}catch(a){}e.loginInfo={}}]),app.controller("RegisterCtrl",["$firebaseSimpleLogin","$scope","$location","simpleLogin",function(e,o,t,l){var a=new Firebase("https://sweltering-fire-3219.firebaseio.com/"),i=!0,n=!1,r=!1;o.loading=!1,o.loginReg={},o.createUser=function(e){o.loading=!0,console.log(o.loginReg);var l=new FirebaseSimpleLogin(a,function(e,i){if(e)console.log(e);else if(i)console.log("already a user"),t.path("/account").replace(),o.$apply();else{var n=o.loginReg.email,r=o.loginReg.password,s=o.loginReg.displayName;l.createUser(n,r,function(e,o){if(null===e){console.log("User created successfully in auth:",o),console.log("Now creating profile:",o),a.child("users").child(o.uid).set({displayName:s,provider:o.provider,provider_id:o.id,email:o.email,role:10,isAdmin:!1}),l.login("password",{email:n,password:r});var t=(new Date).valueOf();a.child("/system/messages").push({title:"User Added (manual)",messageContent:s+" ("+n+") registered.",messageType:"User",timestamp:t})}else console.log("Error creating user:",e)})}})}}]),app.controller("AccountCtrl",["$scope","Profile","currentUser","$firebase","$location","filterFilter",function(e,o,t,l,a,i){function n(o){var t="https://sweltering-fire-3219.firebaseio.com/users",l=new Firebase(t);console.log(l),l.child(o).once("value",function(o){var t=null!==o.val(),l=o.val();if(l.role)var a=l.role;else var a=0;var i=l.role>50;e.userRole=a,e.userAaa=i})}var r,s,c,u,d;e.unreadMessages=r,e.aaa=!1,e.isLoadingMessages=!0,e.locationObject=d,t?(s=o(t.uid),s.$loaded().then(function(){e.profile=s;var o=t.uid;c=s.picture_url,"google"==t.provider?(console.log("provider is google"),u=t.thirdPartyUserData.picture):"facebook"==t.provider&&(console.log("provider is facebook"),u=t.thirdPartyUserData.picture.data.url),u&&c!==u?(console.log("profile images are different, so change them"),new Firebase("https://sweltering-fire-3219.firebaseio.com/users").child(t.uid).update({picture_url:u})):console.log("profile images match, as you were."),e.autoObject=function(o){d=o,e.locationObject=o,e.profile.location=d.title,console.log(e.locationObject)},n(o)})):(a.path("#/home").replace(),e.$apply())}]),app.controller("ProfileCtrl",["$scope","Profile","currentUser","$firebase","$location","filterFilter",function(e,o,t,l,a,i){function n(o){var t="https://sweltering-fire-3219.firebaseio.com/users",l=new Firebase(t);console.log(l),l.child(o).once("value",function(o){var t=null!==o.val(),l=o.val();if(l.role)var a=l.role;else var a=0;var i=l.role>50;e.userRole=a,e.userAaa=i})}var r,s;if(e.unreadMessages=r,e.aaa=!1,e.isLoadingMessages=!0,e.allBooks=s,t){e.profile=o(t.uid);var c=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/");c.once("value",function(o){var t=null!==o.val();s=o.val(),e.allBooks=s});var u=t.uid,d=new Firebase("https://sweltering-fire-3219.firebaseio.com/system/messages/");d.once("value",function(o){var t=null!==o.val();r=o.val(),e.unreadMessages=r});var g=l(d),p=g.$asArray();p.$loaded().then(function(){e.notifications=p,console.log(p),e.hasData=!0,e.isLoadingMessages=!1;var o=i(p,{isRead:!1});e.unreadMessagesArray=o,angular.forEach(p,function(e,o){var t=p.$getRecord(e.$id);if(t.isRead){var l=new Date-t.readDate;t.readDistance=l,p.$save(t)}else{var a=(new Date).valueOf();t.isRead=!0,t.readDate=a,p.$save(t)}});var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/"),a=(new Date).valueOf();l.child(t.uid).update({messagesViewed:a})}),n(u)}else a.path("#/home").replace(),e.$apply()}]),app.controller("FollowingCtrl",["$scope","Profile","currentUser","$firebase","$location","filterFilter",function(e,o,t,l,a,i){var n;if(e.unreadMessages=n,e.aaa=!1,e.isLoadingMessages=!0,t){e.profile=o(t.uid);var r=t.uid,s=new Firebase("https://sweltering-fire-3219.firebaseio.com/system/messages/");s.once("value",function(o){var t=null!==o.val();n=o.val(),console.log(n),e.unreadMessages=n});var c=l(s),u=c.$asArray();u.$loaded().then(function(){e.notifications=u,console.log(u),e.hasData=!0,e.isLoadingMessages=!1;var o=i(u,{isRead:!1});e.unreadMessagesArray=o,console.log(o),angular.forEach(u,function(e,o){console.log(o,e);var t=u.$getRecord(e.$id);if(t.isRead){console.log("readdade is "+t.readDate),console.log("isread is "+t.isRead);var l=new Date-t.readDate;console.log(l),t.readDistance=l,u.$save(t)}else{console.log("not readbefore");var a=(new Date).valueOf();t.isRead=!0,t.readDate=a,u.$save(t)}});var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/"),a=(new Date).valueOf();l.child(t.uid).update({messagesViewed:a})})}else a.path("#/home").replace(),e.$apply()}]),app.controller("ManagePlacesCtrl",["$scope","currentUser","$firebase",function(e,o,t){var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/"),a=null,i=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/places/")).$asArray();i.$loaded().then(function(){e.placelist=i,a=i}),e.placelist=a}]),app.controller("ManageUsersCtrl",["$scope","currentUser","$firebase","ngDialog","filterFilter",function(e,o,t,l,a){var i;e.usersList;var n=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/")).$asArray();n.$loaded().then(function(){console.log(n),angular.forEach(n,function(e,o){var t=null;if(e.collections){var l=0;angular.forEach(e.collections,function(){l++}),console.log("the collection count is:"+l)}}),i=n,e.usersList=n}),e.manageBadges=function(o){e.theUserId=o;var a=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/badges/")).$asArray(),i=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o).child("badges")).$asArray();a.$loaded().then(function(){e.allBadges=a,console.log(a)}),l.open({plain:!1,template:"views/dialogs/dialogBadges.html",scope:e})},e.addBadge=function(e,o,t){if(console.log(o),console.log(e),console.log(t),e){var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(e),a=new Firebase("https://sweltering-fire-3219.firebaseio.com/badges/").child(o);a.once("value",function(e){var t=null!==e.val(),a=e.val();console.log(a),l.child("badges").child(o).update(a)})}}}]),app.controller("EditPlaceCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource",function(e,o,t,l,a,i,n){console.log(l);var r=l.place,s=l.placeid;e.placename=r,e.placeid=s;var c=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/").child(s);c.setPriority(1e3);var u=t(c),d=null,g=u.$asObject();g.$loaded().then(function(){e.place=g,e.hasData=!0}),e.place=g,console.log(e.sync),console.log(e.place);var p=c.child("images");e.addUrl=function(){e.isLooking=!0,e.urlString&&p.push({src:e.urlString,source:e.urlSource,sourceUrl:e.urlSourceUrl,author:e.urlAuthor,authorUrl:e.urlAuthorUrl,addedById:o.uid,addedByName:o.displayName}),e.urlString="",e.urlSource="",e.urlSourceUrl="",e.urlAuthor="",e.urlAuthorUrl="",e.isLooking=!1}}]),app.controller("ManagePlaceCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource",function(e,o,t,l,a,i,n){var r=l.place,s=l.placeid;e.placename=r,e.placeid=s,console.log(r);var c=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/").child(s);c.setPriority(1e3);var u=t(c),d=null,g=u.$asObject();g.$loaded().then(function(){e.place=g,e.hasData=!0,console.log("yep");var o="http://api.geonames.org/searchJSON?q="+e.place.displayName+"&lang=en&style=short&maxRows=1&type=json&username=thirdman";apiData=function(o){e.dataSet=o,console.log(o),o.geonames.length&&(e.hasData=!0),e.geoplace=o.geonames[0]},n.get(o,apiData)}),e.place=g,console.log(e.geoplace),console.log(e.place),e.geosubmit=function(){e.geoplace.name&&c.update({displayName:e.geoplace.name,geonameId:e.geoplace.geonameId,countryCode:e.geoplace.countryCode,gps:{lat:e.geoplace.lat,lng:e.geoplace.lng}})}}]),app.controller("EditBookCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource","$q","$http","$filter",function(e,o,t,l,a,i,n,r,s,c){var u=l.id,d=null;e.newSetting=null,console.log(l.id);var g=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+u),p=t(g);console.log(p),e.bookobj=p.$asObject(),e.book=p.$asObject(),console.log(e.book),e.autoObject=function(o){console.log(o),d=o.originalObject;var t=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+u+"/places/"),l=new Firebase("https://sweltering-fire-3219.firebaseio.com/places/");t.child(d.geonameId).set(d),l.child(d.geonameId).set(d),console.log(d),e.newSetting=d},e.newSetting=d;var f=t(new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/"+u+"/tags/")).$asArray();console.log(f),e.bookLocations=f,e.removePlace=function(o){console.log(o);var l=new Firebase("https://sweltering-fire-3219.firebaseio.com/Books/").child(u).child("/places/");e.removeItemList=t(l);var a=e.removeItemList;console.log(l),console.log(a),e.removeItemList.$remove(o.geonameId)},e.removePriority=function(){g.setPriority(null)},e.setPriority=function(){g.setPriority(1e3)}}]),app.controller("AddMessageCtrl",["$scope","currentUser","$firebase","$routeParams","$location","filterFilter","DataSource","Profile",function(e,o,t,l,a,i,n,r){e.isLoading=!1,e.messageAuthor="";var s=new Firebase("https://sweltering-fire-3219.firebaseio.com/");if(o){var c=new Firebase("https://sweltering-fire-3219.firebaseio.com/users/").child(o.uid);c.once("value",function(t){var l=null!==t.val(),a=t.val();e.profile=a,console.log(a.name);var i=a.name;e.messageAuthor=i,console.log(a);var n=o.uid})}var u=s.child("system/messages");e.updateMessages=function(){var t="System",l=(new Date).valueOf();if(e.message.link)var i=e.message.link;else i="";e.message.content&&u.push({title:e.message.title,authorName:e.messageAuthor,authorId:o.uid,messageType:t,messageLink:i,timestamp:l,messageContent:e.message.content},function(o){a.path("/account").replace(),e.$apply()})}}]),app.filter("uniqueTags",function(){return function(e){var o={};angular.forEach(e,function(e,t){angular.forEach(e.tags,function(e){o[e]=1})});var t=[];for(var l in o)t.push(l);return t}}),app.filter("to_trusted",["$sce",function(e){return function(o){return e.trustAsHtml(o)}}]),app.filter("to_trusted_lines",["$sce",function(e){return function(o){var t=String(o).replace(/<p>/gm,"###startp###");return t=t.replace(/<\/p>/gm,"###endp###"),t=t.replace(/<br>/gm,"###br###"),t=t.replace(/<br\/>/gm,"###br###"),t=t.replace(/<[^>]+>/gm,""),t=t.replace(/###startp###/gm,"<p>"),t=t.replace(/###endp###/gm,"</p>"),t=t.replace(/###br###/gm,"<br>"),t=t.replace(/###startp###/gm,"<p>"),t=t.replace(/\s{2,}/g," "),e.trustAsHtml(t)}}]),app.filter("to_lines",["$sce",function(e){return function(e){var o=String(e).replace(/<p>/gm,"###startp###");return o=o.replace(/<\/p>/gm,"###endp###"),o=o.replace(/<br>/gm,"###br###"),o=o.replace(/<br\/>/gm,"###br###"),o=o.replace(/<[^>]+>/gm,""),o=o.replace(/###startp###/gm,""),o=o.replace(/###endp###/gm,"\n\r\n"),o=o.replace(/###br###/gm,""),o=o.replace(/\s{2,}/g," ")}}]),app.filter("to_plain",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}});var validHTMLTags=/^(?:i|p|br)$/i;app.filter("to_plain_keep_some",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}),angular.module("ng").filter("cut",function(){return function(e,o,t,l){if(!e)return"";if(t=parseInt(t,10),!t)return e;if(e.length<=t)return e;if(e=e.substr(0,t),o){var a=e.lastIndexOf(" ");-1!=a&&(e=e.substr(0,a))}return e+(l||" ?")}});